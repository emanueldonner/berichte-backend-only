let t=!1,e=1,i=1;const n={active:!1,x:0,targetX:0,y:0,startDist:0,dist:0,lastDist:1,offset:0};let o=Object.assign({},n);const s={lastX:0,lastY:0,moving:!1,moved:!1};let a,m=Object.assign({},s),h=!1,r=()=>{};const c=new Event("reset");let l,g=!1;const d=function(t){return this.image={elem:t.img},setTimeout((()=>{this.getImageData(),this.image.zoomedClass=t.zoomedClass,this.image.zoomEvent=t.zoomEvent,t.onReset&&(r=t.onReset),this.container="string"==typeof t.container?document.querySelector(t.container):t.container,this.addEvents(),this.image.zoomEvent&&("dblclick"===t.zoomEventType?this.zoomOnDoubleTap(this.image.zoomEvent):this.zoomOnPinch(this.image.zoomEvent))}),150),this};d.prototype.getImageData=function(){this.image.originalHeight=this.image.elem.height,this.image.originalRect=this.image.elem.getBoundingClientRect(),this.image.x=this.image.elem.getBoundingClientRect().left,this.image.y=this.image.elem.getBoundingClientRect().top},d.prototype.isDoubleTap=function(){return!!g||(g=!0,window.setTimeout((function(){g=!1}),300),!1)},d.prototype.pinchGetDist=function(t){return Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY)},d.prototype.resizeImage=function(){this.resetZoom(),this.getImageData()},d.prototype.addEvents=function(){this.container.addEventListener("touchstart",this.startHandler.bind(this)),this.container.addEventListener("touchmove",this.moveHandler.bind(this)),this.container.addEventListener("touchend",this.endHandler.bind(this)),this.container.addEventListener("reset",r),l=this.resizeImage.bind(this),this.container.addEventListener("resize",l)},d.prototype.destroyEvents=function(){this.container.removeEventListener("resize",l)},d.prototype.zoomOnPinch=function(t){o.active=!0,o.x=(t.touches[0].clientX+t.touches[1].clientX)/2,o.y=(t.touches[0].clientY+t.touches[1].clientY)/2,o.startDist=this.pinchGetDist(t)},d.prototype.zoomOnDoubleTap=function(n){m.moving=!1,i=e,t?this.resetZoom():(e=2,this.zoom(n.touches[0].clientX,n.touches[0].clientY))},d.prototype.resetZoom=function(a,h){e=1,i=1,this.image.elem.removeAttribute("style"),this.image.elem.classList.remove(this.image.zoomedClass),t=!1,this.image.x=this.image.elem.getBoundingClientRect().left,this.image.y=this.image.elem.getBoundingClientRect().top,o=n,m=s,this.container.classList.remove("wm-zoom-active"),document.querySelector(".js-wm-site").classList.remove("wm-is-zoomed"),this.container.dispatchEvent(c)},d.prototype.moveImage=function(t,e){clearInterval(h),h=!1,t>window.innerWidth/2&&(t=window.innerWidth/2),e>window.innerHeight/2&&(e=window.innerHeight/2),this.image.elem.getBoundingClientRect().height+e<=window.innerHeight/2&&(e=-1*(this.image.elem.getBoundingClientRect().height-window.innerHeight/2)),this.image.elem.getBoundingClientRect().width+t<=window.innerWidth/2&&(t=-1*(this.image.elem.getBoundingClientRect().width-window.innerWidth/2)),this.image.elem.style.transform=`translateX(${t}px) translateY(${e}px)`,this.image.x=t,this.image.y=e},d.prototype.zoom=function(n,o){this.image.elem.style.height=this.image.originalRect.height*e+"px";var s=n-(-1*this.image.x+n)/i*e,a=o-(-1*this.image.y+o)/i*e;t=!0,this.container.classList.add("wm-zoom-active"),document.querySelector(".js-wm-site").classList.add("wm-is-zoomed"),this.image.elem.classList.add(this.image.zoomedClass),this.moveImage(s,a)},d.prototype.startHandler=function(e){if(e.preventDefault(),"true"===this.image.elem.dataset.wmZoomDisable)return;if(2===e.touches.length)return void this.zoomOnPinch(e);m.lastX=e.touches[0].clientX,m.lastY=e.touches[0].clientY,t&&(a=performance.now(),h&&(clearInterval(h),h=!1));if(!this.isDoubleTap())return m.moving=!0,!1;m.moved||this.zoomOnDoubleTap(e)},d.prototype.moveHandler=function(n){if("true"!==this.image.elem.dataset.wmZoomDisable&&(o.active&&(o.dist=this.pinchGetDist(n),i=e,e=o.dist>o.lastDist?o.lastDist*Math.abs(o.dist/o.startDist):o.lastDist*Math.abs(o.startDist/o.dist),e>=5&&(e=5),e<1?this.resetZoom():(t=!0,t&&(m.moving=!1,this.zoom(o.x,o.y)))),m.moving&&t)){m.moved=!1,performance.now()-a>60&&(m.moved=!0);var s=Math.round(m.lastX-n.touches[0].clientX),h=Math.round(m.lastY-n.touches[0].clientY);m.lastX=n.touches[0].clientX,m.lastY=n.touches[0].clientY;var r=this.image.x-s,c=this.image.y-h;this.moveImage(r,c)}},d.prototype.endHandler=function(t){"true"!==this.image.elem.dataset.wmZoomDisable&&(o.active=!1,o.lastDist=e,m.moving=!1,m.moved=!1)};export{d as wmImageZoom};