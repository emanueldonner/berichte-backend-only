var t=function(t,o,i){this.comboboxNode=t,this.buttonNode=o,this.listboxNode=i,this.comboboxHasVisualFocus=!1,this.listboxHasVisualFocus=!1,this.hasHover=!1,this.isNone=!1,this.isList=!1,this.isBoth=!1,this.allOptions=[],this.allOptionsUnchanged=[],this.option=null,this.firstOption=null,this.lastOption=null,this.filteredOptions=[],this.filter=""};t.prototype.init=function(){var t=this.comboboxNode.getAttribute("aria-autocomplete");"string"==typeof t?(t=t.toLowerCase(),this.isNone="none"===t,this.isList="list"===t,this.isBoth="both"===t):this.isNone=!0,this.comboboxNode.addEventListener("keydown",this.handleComboboxKeyDown.bind(this)),this.comboboxNode.addEventListener("keyup",this.handleComboboxKeyUp.bind(this)),this.comboboxNode.addEventListener("input",this.handleComboboxInput.bind(this)),this.comboboxNode.addEventListener("click",this.handleComboboxClick.bind(this)),this.comboboxNode.addEventListener("focus",this.handleComboboxFocus.bind(this)),this.comboboxNode.addEventListener("blur",this.handleComboboxBlur.bind(this)),this.listboxNode.addEventListener("mouseover",this.handleListboxMouseover.bind(this)),this.listboxNode.addEventListener("mouseout",this.handleListboxMouseout.bind(this));for(var o=this.listboxNode.getElementsByTagName("LI"),i=0;i<o.length;i++){var s=o[i];this.allOptions.push(s),s.addEventListener("click",this.handleOptionClick.bind(this)),s.addEventListener("mouseover",this.handleOptionMouseover.bind(this)),s.addEventListener("mouseout",this.handleOptionMouseout.bind(this))}this.allOptionsUnchanged=this.allOptions,this.filterOptions();var e=this.comboboxNode.nextElementSibling;e&&"BUTTON"===e.tagName&&e.addEventListener("click",this.handleButtonClick.bind(this)),document.addEventListener("comboboxfiltered",(t=>{"alle"===t.detail?this.allOptions=this.allOptionsUnchanged:this.allOptions=this.allOptionsUnchanged.filter((o=>o.getAttribute("data-combo-box-option")===t.detail))}),!1)},t.prototype.getLowercaseContent=function(t){return t.textContent.toLowerCase()},t.prototype.setActiveDescendant=function(t){t&&this.listboxHasVisualFocus?this.comboboxNode.setAttribute("aria-activedescendant",t.id):this.comboboxNode.setAttribute("aria-activedescendant","")},t.prototype.setValue=function(t,o){this.filter=t,this.comboboxNode.value=this.filter,this.comboboxNode.setSelectionRange(this.filter.length,this.filter.length),this.comboboxNode.setAttribute("data-combonode-id",o),this.filterOptions()},t.prototype.setOption=function(t,o){"boolean"!=typeof o&&(o=!1),t&&(this.option=t,this.setCurrentOptionStyle(this.option),this.setActiveDescendant(this.option),this.isBoth&&(this.comboboxNode.value=this.option.textContent,this.comboboxNode.setAttribute("data-combonode-id",this.option.id),o?this.comboboxNode.setSelectionRange(this.option.textContent.length,this.option.textContent.length):this.comboboxNode.setSelectionRange(this.filter.length,this.option.textContent.length)))},t.prototype.setVisualFocusCombobox=function(){this.listboxNode.classList.remove("focus"),this.comboboxNode.parentNode.classList.add("focus"),this.comboboxHasVisualFocus=!0,this.listboxHasVisualFocus=!1,this.setActiveDescendant(!1)},t.prototype.setVisualFocusListbox=function(){this.comboboxNode.parentNode.classList.remove("focus"),this.comboboxHasVisualFocus=!1,this.listboxHasVisualFocus=!0,this.listboxNode.classList.add("focus"),this.setActiveDescendant(this.option)},t.prototype.removeVisualFocusAll=function(){this.comboboxNode.parentNode.classList.remove("focus"),this.comboboxHasVisualFocus=!1,this.listboxHasVisualFocus=!1,this.listboxNode.classList.remove("focus"),this.option=null,this.setActiveDescendant(!1)},t.prototype.filterOptions=function(){this.isNone&&(this.filter="");var t=null,o=this.option,i=this.filter.toLowerCase();this.filteredOptions=[],this.listboxNode.innerHTML="";for(var s=0;s<this.allOptions.length;s++)t=this.allOptions[s],0!==i.length&&0!==this.getLowercaseContent(t).indexOf(i)||(this.filteredOptions.push(t),this.listboxNode.appendChild(t));var e=this.filteredOptions.length;return e>0?(this.firstOption=this.filteredOptions[0],this.lastOption=this.filteredOptions[e-1],t=o&&this.filteredOptions.indexOf(o)>=0?o:this.firstOption):(this.firstOption=null,t=null,this.lastOption=null),t},t.prototype.setCurrentOptionStyle=function(t){for(var o=0;o<this.filteredOptions.length;o++){var i=this.filteredOptions[o];i===t?(i.setAttribute("aria-selected","true"),this.listboxNode.scrollTop+this.listboxNode.offsetHeight<i.offsetTop+i.offsetHeight?this.listboxNode.scrollTop=i.offsetTop+i.offsetHeight-this.listboxNode.offsetHeight:this.listboxNode.scrollTop>i.offsetTop+2&&(this.listboxNode.scrollTop=i.offsetTop)):i.removeAttribute("aria-selected")}},t.prototype.getPreviousOption=function(t){if(t!==this.firstOption){var o=this.filteredOptions.indexOf(t);return this.filteredOptions[o-1]}return this.lastOption},t.prototype.getNextOption=function(t){if(t!==this.lastOption){var o=this.filteredOptions.indexOf(t);return this.filteredOptions[o+1]}return this.firstOption},t.prototype.doesOptionHaveFocus=function(){return""!==this.combobocNode.getAttribute("aria-activedescendant")},t.prototype.isOpen=function(){return this.listboxNode.classList.contains("wm-combo-box__list--visible")},t.prototype.isClosed=function(){return!this.listboxNode.classList.contains("wm-combo-box__list--visible")},t.prototype.hasOptions=function(){return this.filteredOptions.length},t.prototype.open=function(){this.listboxNode.classList.add("wm-combo-box__list--visible"),this.comboboxNode.setAttribute("aria-expanded","true"),this.buttonNode.setAttribute("aria-expanded","true")},t.prototype.close=function(t){"boolean"!=typeof t&&(t=!1),!t&&(this.comboboxHasVisualFocus||this.listboxHasVisualFocus||this.hasHover)||(this.setCurrentOptionStyle(!1),this.listboxNode.classList.remove("wm-combo-box__list--visible"),this.comboboxNode.setAttribute("aria-expanded","false"),this.buttonNode.setAttribute("aria-expanded","false"),this.setActiveDescendant(!1))},t.prototype.dispatchInputEvent=function(){this.comboboxNode.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))},t.prototype.handleComboboxKeyDown=function(t){var o=!1,i=t.altKey;if(!t.ctrlKey&&!t.shiftKey){switch(t.keyCode){case 13:this.listboxHasVisualFocus&&this.setValue(this.option.textContent,this.option.id),this.close(!0),this.setVisualFocusCombobox(),o=!0,this.dispatchInputEvent(),this.comboboxNode.hasAttribute("data-combobox-jump")&&this.option.id&&(location.href=this.option.id);break;case 40:this.filteredOptions.length>0&&(i?this.open():(this.open(),this.listboxHasVisualFocus||this.isBoth&&this.filteredOptions.length>1?(this.setOption(this.getNextOption(this.option),!0),this.setVisualFocusListbox()):(this.setOption(this.firstOption,!0),this.setVisualFocusListbox()))),o=!0;break;case 38:this.hasOptions()&&(this.listboxHasVisualFocus?this.setOption(this.getPreviousOption(this.option),!0):(this.open(),i||(this.setOption(this.lastOption,!0),this.setVisualFocusListbox()))),o=!0;break;case 27:this.isOpen()?(this.close(!0),this.filter=this.comboboxNode.value,this.filterOptions(),this.setVisualFocusCombobox()):(this.setValue("",""),this.comboboxNode.value=""),this.option=null,o=!0;break;case 9:this.close(!0),this.listboxHasVisualFocus&&this.option&&this.setValue(this.option.textContent,this.option.id);break;case 36:this.comboboxNode.setSelectionRange(0,0),o=!0;break;case 35:var s=this.comboboxNode.value.length;this.comboboxNode.setSelectionRange(s,s),o=!0}o&&(t.stopPropagation(),t.preventDefault())}},t.prototype.isPrintableCharacter=function(t){return t&&1===t.length&&t.match(/\S/)},t.prototype.handleComboboxInput=function(t){var o=t.data,i=!1,s=null;this.isPrintableCharacter(o)&&(this.filter+=o),this.comboboxNode.value.length<this.filter.length&&(this.filter=this.comboboxNode.value,this.option=null,this.filterOptions());-1===[27,8,35,36,37,39].indexOf(t.keyCode)&&(this.isPrintableCharacter(o)&&(this.setVisualFocusCombobox(),this.setCurrentOptionStyle(!1),i=!0,this.isList||this.isBoth?(s=this.filterOptions())?(this.isClosed()&&this.comboboxNode.value.length&&this.open(),0===this.getLowercaseContent(s).indexOf(this.comboboxNode.value.toLowerCase())?(this.option=s,(this.isBoth||this.listboxHasVisualFocus)&&(this.setCurrentOptionStyle(s),this.isBoth&&this.setOption(s))):(this.option=null,this.setCurrentOptionStyle(!1))):(this.close(),this.option=null,this.setActiveDescendant(!1)):this.comboboxNode.value.length&&this.open()),i&&(t.stopPropagation(),t.preventDefault()))},t.prototype.handleComboboxKeyUp=function(t){var o=!1;if(27!==t.keyCode){switch(t.keyCode){case 8:this.setVisualFocusCombobox(),this.setCurrentOptionStyle(!1),this.filter=this.comboboxNode.value,this.option=null,this.filterOptions(),o=!0;break;case 35:case 36:case 37:case 39:this.isBoth?this.filter=this.comboboxNode.value:(this.option=null,this.setCurrentOptionStyle(!1)),this.setVisualFocusCombobox(),o=!0}o&&(t.stopPropagation(),t.preventDefault())}},t.prototype.handleComboboxClick=function(t){this.isOpen()?this.close(!0):this.open()},t.prototype.handleComboboxFocus=function(t){this.filter=this.comboboxNode.value,this.filterOptions(),this.setVisualFocusCombobox(),this.option=null,this.setCurrentOptionStyle(null)},t.prototype.handleComboboxBlur=function(t){this.comboboxHasVisualFocus=!1,this.setCurrentOptionStyle(null),this.removeVisualFocusAll(),setTimeout(this.close.bind(this,!1),300)},t.prototype.handleButtonClick=function(t){this.isOpen()?this.close(!0):this.open(),this.comboboxNode.focus(),this.setVisualFocusCombobox()},t.prototype.handleListboxMouseover=function(t){this.hasHover=!0},t.prototype.handleListboxMouseout=function(t){this.hasHover=!1,setTimeout(this.close.bind(this,!1),300)},t.prototype.handleOptionClick=function(t){this.comboboxNode.value=t.target.textContent,this.comboboxNode.setAttribute("data-combonode-id",t.target.id),this.comboboxNode.hasAttribute("data-combobox-jump")&&t.target.id&&(location.href=t.target.id),this.close(!0),this.dispatchInputEvent()},t.prototype.handleOptionMouseover=function(t){this.hasHover=!0,this.open()},t.prototype.handleOptionMouseout=function(t){this.hasHover=!1,setTimeout(this.close.bind(this,!1),300)};const o=()=>{if(document.querySelectorAll(".js-wm-combo-box").length){const h=document.querySelectorAll(".js-wm-combo-box");for(var o=0;o<h.length;o++){var i=h[o],s=i.querySelector("input"),e=i.querySelector("button"),n=i.querySelector('[role="listbox"]');new t(s,e,n).init()}}};export{o as initComboBoxes};