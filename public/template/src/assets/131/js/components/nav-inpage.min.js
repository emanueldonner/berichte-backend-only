import{newScrollSpy as e}from"./scrollspy.min.js";import{isContentFull as t}from"./utils.min.js";import{wmBodyLock as n}from"./utils.min.js";import{initTabs as a}from"./tabs.min.js";const i=new n,r="h2[id], [data-wm-scroll-anchor]",o=()=>{const e=document.querySelector("[data-wm-inpage-nav]");if(!e||!document.querySelectorAll(r).length)return;if(!document.querySelector("[data-wm-site-content]"))throw new Error('"[data-wm-site-content]" auf <main> fehlt.');const n=e.dataset.wmInpageNav;l(e);var a=c(e,n);m(a,e),d(document.querySelector(".wm-nav-inpage")),document.documentElement.classList.add("wm-has-inpage"),"toggle"===n&&s();const i=t=>{t.matches?(w(),e.querySelector("nav").removeAttribute("inert")):(w(),"toggle"===n&&e.querySelector("nav").setAttribute("inert",!0))};t.addListener(i),i(t)},s=()=>{const e=document.createElement("button");let t;e.textContent="Thema wählen",e.classList.add("wm-btn--clean","wm-nav-inpage__toggle"),e.setAttribute("aria-expanded",!1),e.addEventListener("click",v),document.querySelector(".js-wm-nav-main-actions")?t=document.querySelector(".js-wm-nav-main-actions"):(t=document.createElement("div"),t.classList.add("wm-nav-main__actions","js-wm-nav-main-actions"),document.querySelector("[data-wm-nav-main]")?document.querySelector("[data-wm-nav-main]").insertAdjacentElement("afterend",t):document.querySelector(".wm-nav-wrapper__inner").appendChild(t)),t.insertBefore(e,t.firstChild)},c=(e,t)=>{const n=document.createElement("nav");n.setAttribute("aria-label","Zu Bereich springen"),n.setAttribute("data-wm-scrollspy",""),"toggle"===t&&n.setAttribute("inert","true"),n.classList.add("wm-nav-inpage",`wm-nav-inpage--${e.dataset.wmInpageNav}`);const a=document.createElement("ol");return a.classList.add("wm-nav-inpage__items",`wm-nav-inpage__items--${e.dataset.wmInpageNav}`),n.appendChild(a),e.insertBefore(n,e.children[0]),a},l=e=>{e.classList.add("wm-nav-inpage__wrapper","wm-u-mbxl");const t=document.createElement("div");t.innerHTML=e.innerHTML,t.classList.add("wm-nav-inpage__content"),e.innerHTML="",e.appendChild(t),initLazyLoading(),a()},m=(e,t)=>{const n=t.querySelectorAll(r);if(!n.length)throw new Error("Keine Links für In-Page Navigation gefunden.");if(!e)throw new Error('".js-wm-nav-inpage-list" nicht gefunden.');for(let t=0;t<n.length;t++){const a=n[t],i=document.createElement("li");i.classList.add("wm-nav-inpage__item"),i.classList.add("js-wm-nav-inpage-item");const r=document.createElement("a");r.classList.add("wm-nav-inpage__link"),r.classList.add("js-wm-nav-inpage-link"),r.href=`#${a.id||a.dataset.wmScrollAnchor}`,r.innerHTML=a.innerHTML,i.appendChild(r),e.appendChild(i)}},d=t=>{const n=t.querySelectorAll('a[href^="#"]');let a=130;document.documentElement.classList.contains("wm-has-ms-nav")&&(a=146);const i=e({offset:[160,a]},(e=>{e.nav.querySelector(".wm-nav-inpage__link--active")&&e.nav.querySelector(".wm-nav-inpage__link--active").classList.remove("wm-nav-inpage__link--active"),e.nav.querySelector(`a[href="#${e.hash}"]`).classList.add("wm-nav-inpage__link--active")}),(e=>{}),(e=>{let t=e.nav.querySelectorAll("a")[0];e.hash&&(t=e.nav.querySelector(`a[href="#${e.hash}"]`)),e.nav.querySelector(".wm-nav-inpage__items").scrollTo({top:0,left:t.offsetLeft,behavior:"smooth"})}));i.init();for(let e=0;e<n.length;e++){const a=n[e];a.hash&&a.addEventListener("click",u.bind(null,i,a,t))}},u=(e,t,n,a)=>{e.setTarget(t),w();var i=window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0);document.body.offsetHeight===window.innerHeight+i&&(n.querySelector(".wm-nav-inpage__link--active").classList.remove("wm-nav-inpage__link--active"),t.classList.add("wm-nav-inpage__link--active"))},v=e=>{e.preventDefault();const t=e.target.closest("button");if(!t)return;const n="true"===t.getAttribute("aria-expanded"),a=document.querySelector(".wm-nav-inpage"),r=document.querySelector(".wm-nav-inpage__items");t.setAttribute("aria-expanded",!n),document.documentElement.classList.toggle("wm-has-overlay"),n?(a.setAttribute("inert",!0),i.unlock()):(a.removeAttribute("inert"),i.lock(r))},w=()=>{const e=document.querySelector(".wm-nav-inpage__toggle");if(e){const t="true"===e.getAttribute("aria-expanded"),n=document.querySelector("[data-wm-inpage-nav]");t?(i.unlock(),e.setAttribute("aria-expanded",!1),document.documentElement.classList.add("wm-has-overlay"),n.querySelector("nav").setAttribute("inert",!0)):document.documentElement.classList.remove("wm-has-overlay")}};export{o as initInPageNav};